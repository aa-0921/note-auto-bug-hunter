// createAndPublishPaidArticle.js
// 有料記事を作成して自動投稿するスクリプト

import { runWithCore } from '@aa-0921/note-auto-core';

// アフィリエイト設定とリンクを別ファイルから読み込み
import { affiliateConfig, affiliateLinks } from './affiliateConfig.js';

// 記事内容配列（A）を読み込み
import articleContents from './articleContents.js';

// 再エクスポート（他のファイルから参照できるように）
export { affiliateConfig, affiliateLinks };

(async () => {
  await runWithCore(async ({ core, wantsBackground }) => {
    // このスクリプトだけ異なるAIモデルを使用する
    core.aiGenerator.models.article = 'tngtech/deepseek-r1t2-chimera:free';
    core.aiGenerator.models.rewrite = 'tngtech/deepseek-r1t2-chimera:free';
    core.aiGenerator.models.tags = 'tngtech/deepseek-r1t2-chimera:free';
    console.log('使用するAIモデル:', core.aiGenerator.models);

    // アカウント固有の題材・切り口（ここで管理）
    // 「1分を24時間にする」コンセプト：当たり前の常識を、個人の知恵や技術でひっくり返す
    const topics = [
      // 1. 限界突破・非常識系
      '「1畳」を「1LDK」として使うAI自動化の空間調律術',
      '睡眠時間を削らずに、1日起き続けている感覚を作るAI技術',
      '0円で「100万円の夜景」を独り占めする具体的な手順',
      '100冊の読書より、1回の「まばたき」で深く学ぶAI活用法',
      '24時間働き続ける感覚を、1時間の作業で実現する自動化術',
      '1回の設定で、1年分のコンテンツを自動生成する仕組み',
      '月1回の作業で、毎日24時間稼働する不労所得システム',
      '1分の入力で、24時間分のSNS投稿を自動化する方法',
      '1回のセットアップで、365日自動で収益を生み出す仕組み',
      '1時間の作業を、24時間の価値に変えるAI活用術',
      // 
      // 2. 数字のレバレッジ系
      '「一言」で1時間の会議を終わらせる魔法のAIフレーズ',
      '100文字のメールで、数億円の案件を動かす心理学',
      '1回の深呼吸で、3時間分のストレスを帳消しにする方法',
      '月給を「時給10万円」に変えるための、たった一つの捨て時',
      '1回のクリックで、24時間分の作業を自動化する技術',
      '1分の設定で、1ヶ月分のコンテンツを量産する方法',
      '1時間の投資で、100時間分の価値を生み出す自動化術',
      '1回の学習で、一生使える不労所得の仕組みを作る方法',
      '1日1分の作業で、月10万円の不労所得を実現する方法',
      '1つのツールで、10個の収益源を同時に回す仕組み',
      // 
      // 3. 逆転の発想・皮肉系
      '「努力」を捨てた瞬間に、成果が10倍になった話',
      'なぜ、成功者は「カレンダー」を使わないのか？',
      '「忘れる」ことこそが、最強の記憶術である理由',
      '友達を全員整理して、本当の「繋がり」を手に入れた30日間',
      '「働かない」ことで、収入が3倍になった自動化の真実',
      '「手を動かさない」ことが、最高の副業戦略である理由',
      '「時間をかけない」ことで、質の高いコンテンツを量産する方法',
      '「頑張らない」自動化で、不労所得を実現した話',
      '「完璧を目指さない」ことで、収益が最大化された理由',
      '「一人でやらない」ことが、最速で成功する秘訣',
      // 
      // 4. SF的・ミステリアス系
      '東京の街中で「完全に透明人間」になる方法',
      '他人の「脳内時間」にログインするコミュニケーション術',
      '明日を「今日」よりも先に体験する、予知的な仕事術',
      '世界が5分前に始まったとしても、困らないための備忘録',
      '時間を「借りる」技術：未来の自分から時間を借りる方法',
      '「並行世界」で同時に複数の収益源を稼ぐ仕組み',
      '「時間の歪み」を利用して、1日を48時間にする技術',
      '「過去の自分」に作業を委託する自動化システム',
      '「未来の収益」を今すぐ受け取る不労所得の作り方',
      '「時間のループ」から抜け出して、真の自由を手に入れる方法',
    ];

    // 記事の切り口・構成のパターン
    // 「1分を24時間にする」コンセプトに基づいた構成パターン
    const patterns = [
      // 常識を覆す導入パターン
      '物理的・社会的な限界を提示し、それを超える方法を提示する構成',
      '「当たり前」と思われていることを否定し、新しい視点を提示する構成',
      '読者の固定観念を揺さぶる問いかけから始める構成',
      '「不可能」と思われていることを「可能」にする方法を示す構成',
      // 
      // 数字の対比で興味を引くパターン
      '「1」vs「24」「0円」vs「100万円」など、具体的な数字の対比で価値を示す構成',
      '小さな入力と巨大な出力のギャップを明確に示す構成',
      '時間の投資対効果を数値で明確に示す構成',
      '「1回の作業」で「継続的な成果」を得る方法を説明する構成',
      // 
      // 逆転の発想パターン
      '世間で良いとされていることを否定し、新しい価値観を提示する構成',
      '「努力」や「頑張り」を否定し、効率化の重要性を示す構成',
      '常識の逆を行くことで、予想外の成果を得た実体験を語る構成',
      '「捨てる」ことで「得る」という逆転の発想を提示する構成',
      // 
      // ミステリアス・SF的パターン
      '日常の中に潜む奇妙な法則を解き明かすような構成',
      '「時間の概念」を再定義するような視点を提示する構成',
      '現実と非現実の境界を曖昧にするような表現で興味を引く構成',
      '「未来の自分」や「並行世界」などの概念を使って説明する構成',
      // 
      // 実践的・具体的パターン
      '「1分を24時間にする」具体的な手順をステップバイステップで解説する構成',
      '実際に使えるツールやワークフローを具体的に紹介する構成',
      '読者がすぐに試せるような具体的なアクションを提示する構成',
      '実体験や具体例を豊富に含めて、再現性を示す構成',
      // 
      // 感情に訴えかけるパターン
      '読者の「時間がない」という悩みに共感し、解決策を提示する構成',
      '「自由な時間を手に入れたい」という願望に訴えかける構成',
      '「不労所得」への憧れを刺激し、実現可能性を示す構成',
      '「常識に縛られない生き方」への憧れを喚起する構成',
      // 
      // 証明・説得パターン
      '実績や成果を具体的な数字で見せる構成',
      'Before/Afterで変化を明確に示す構成',
      '成功事例を複数紹介して再現性を示す構成',
      'データや統計を根拠に説得力を高める構成',
      // 
      // 実践支援パターン
      'チェックリスト形式で実践しやすくする構成',
      'よくある間違いを指摘して正解を示す構成',
      '読者の不安を先回りして解消する構成',
      'リスクと対策をセットで提示する構成',
    ];

    const rewriteConditionsLines = [
      'あなたはAIを活用した副業・自動化の専門家です。',
      '指定の見出し本文が短いため、200文字以上になるよう実体験や具体例、実践的なアドバイスを交えて厚くリライトしてください。',
      '読者は副業初心者〜中級者で、AIに興味はあるがまだうまく使いこなせていない人です。',
      '難しい専門用語はできるだけ避け、噛み砕いた説明で安心感を与えてください。',
      '【注意】',
      '- タイトルや見出しは出力せず、本文のみを返す。',
      '- メタ情報（追加要素や文字数など）は一切出力しない。',
      '- 丁寧な敬語（です・ます）で、読みやすさ重視。',
      '- 絵文字を多めに、各行に1つ程度。',
      '- 元の内容に沿い、noteのMarkdownのみ使用。',
      '- 箇条書きは「・ 」、番号付きリストは使わない。',
      '- 特殊トークンや制御文字（<|begin_of_sentence|>等）は絶対に出力しない。',
      '- 自然で読みやすい日本語のみを出力する。',
      '- 完成した文章のみを返し、システムメッセージや処理情報は含めない。',
      '- 日本語の文章の中に英単語を混ぜないでください。すべて日本語で表現してください。',
      '- 【重要】絵文字を使用する場合は句読点（。や、）は付けないでください。句読点と絵文字を同時に使うことは禁止です。絵文字を使う場合は句読点は不要です。',
    ];

    // LLM用システムプロンプト（AI稼ぎ方.mdのテイストに準拠）
    const systemMessage =
      'あなたはAIを活用した副業・自動化の専門家で、日本語のnote記事編集者です。「AI稼ぎ方.md」にあるような、有料記事として価値のある構成と濃さで記事を作成してください。' +
      '【最重要】記事は必ず「## 有料セクション」の見出しを含め、その後に5000文字程度の詳細な内容を最後まで完全に生成してください。途中で生成を止めてはいけません。';

    // 記事生成プロンプト条件（有料記事用の構造を含む）
    const articleConditionsLines = [
      '【最重要】記事は必ず以下の4つの見出しを含めて、最後まで完全に生成してください：',
      '1. ## はじめに',
      '2. ## 有料記事部分のご紹介',
      '3. ## 有料部分の内容について',
      '4. ## 有料セクション',
      '',
      '【最重要】「## 有料セクション」の見出しの後に、必ず5000文字程度の詳細な内容を書いてください。',
      '記事が途中で終わってはいけません。「## 有料セクション」の内容を最後まで完全に生成してください。',
      '',
      'タイトル、本文、ハッシュタグ（#から始まるもの）を含めてください。',
      'タイトルは1行目に「# [実際のタイトル] | ライフハック | 改善 」として記載してください。',
      '「# タイトル」という文字列ではなく、実際の記事タイトルを入れてください。',
      'タイトルや本文には、できるだけ「AI」「自動化」「副業」「不労所得」などのキーワードを自然な形で盛り込んでください。',
      '本文にはタイトルを含めないでください。',
      '',
      '【記事の構造】以下の順序で必ず作成してください：',
      '',
      '## はじめに',
      '導入部分（無料で読める部分、500文字程度）',
      '   ・ 読者の興味を引く導入',
      '   ・ 記事の概要や背景',
      '   ・ 読者が共感できる悩みや不安',
      '',
      '## 有料記事部分のご紹介',
      '有料記事部分のメリット案内（200文字程度）',
      '   ・ 有料セクションで読める記事内容の価値やメリットのみを記載',
      '   ・ 記事の内容以外のサービス（スクリーンショット、ショートカット一覧、サポート体制など）は絶対に記載しない',
      '   ・ 記事コンテンツで得られる知識やノウハウのみを説明する',
      '',
      '## 有料部分の内容について',
      '有料部分でどんな記事内容が読めるのかを読者に伝えるセクションです。',
      '   ・ 箇条書き（「・ 」）で3〜7個程度、記事内のトピックを並べてください。',
      '   ・ 各項目は1〜2文で簡潔に、でも具体的に記述してください。',
      '   ・ 「誰向けか」「どんな変化・成果が期待できるか」も含めてください。',
      '   ・ ここはあくまで有料部分の"目次・要約"であり、本文そのものではありません。',
      '   ・ 【重要】記事の内容のみを記載し、記事以外のサービス（スクリーンショット、ショートカット一覧、サポート体制、質問し放題など）は絶対に記載しないでください。',
      '',
      '## 有料セクション',
      '【重要】このセクションは5000文字程度の詳細な内容を必ず書いてください。',
      '   ・ 具体的で実践的な内容',
      '   ・ 読者が求める深い情報やノウハウ',
      '   ・ 見出し（### サブ見出し）や箇条書きを交えて丁寧にまとめてください',
      '   ・ AIを丸投げではなく「相棒」や「編集者」として使う考え方を伝えてください',
      '   ・ ステップバイステップの手順や長期的な視点を含めてください',
      '   ・ 実体験や具体例を豊富に含めてください',
      '   ・ このセクションを最後まで完全に生成してください。途中で終わってはいけません。',
      '',
      '【最終確認】記事には必ず以下の4つの見出しが順番通りに含まれていることを確認してください：',
      '1. ## はじめに',
      '2. ## 有料記事部分のご紹介',
      '3. ## 有料部分の内容について',
      '4. ## 有料セクション（この後に5000文字程度の詳細な内容を必ず書く）',
      '',
      'ハッシュタグは記事末尾に「#〇〇 #〇〇 ...」の形式でまとめてください。',
      'あなたはAIを活用した副業・自動化の専門家で、プロの編集者です。',
      '読みやすさを重視してください。',
      '可能であればランキング形式やステップ形式を取り入れてください。',
      '改行を多めに入れてください。',
      '各行に1つ程度、絵文字を使用してください。',
      'すべて日本語で出力してください。',
      '切り口に沿った内容にしてください。',
      'noteの正しいマークダウン記法のみを使ってください。',
      '箇条書きはマークダウンではなく、「・ 」で表現してください。',
      '見出しはh2（## 見出し）・h3（### 見出し）のみ。',
      '見出しに「**」等は使わないでください。',
      '番号付きリストは使わないでください。',
      'h1（# タイトル）はタイトル行のみで本文中では使わないでください。',
      'その他のマークダウンやHTMLタグは使わないでください。',
      '【重要】特殊トークンや制御文字（<|begin_of_sentence|>、<|end_of_sentence|>等）は絶対に出力しないでください。',
      '【重要】自然で読みやすい日本語のみを出力し、システムメッセージや処理情報は一切含めないでください。',
      '【重要】完成した記事のみを返してください。',
      '【重要】日本語の文章の中に英単語を混ぜないでください。すべて日本語で表現してください。',
      '【重要】絵文字を使用する場合は句読点（。や、）は付けないでください。句読点と絵文字を同時に使うことは禁止です。絵文字を使う場合は句読点は不要です。例：「誰でも始められる不労所得の選択肢が広がります🌐」のように、絵文字の前後に句読点を付けないでください。',
      '',
      '【禁止事項】記事の提供以外のサービスを保証するような内容は絶対に記載しないでください。',
      '   ・ スクリーンショットの提供',
      '   ・ ショートカット一覧の提供',
      '   ・ サポート体制や質問し放題のサービス',
      '   ・ 記事以外の特典や追加サービス',
      '   ・ 上記のような内容を暗示する表現も使用しないでください。',
      '',
      '【最終確認】記事には必ず「## 有料部分の内容について」と「## 有料セクション」という見出しが含まれていることを確認してください。',
      'これらの見出しが含まれていない記事は無効です。',
    ];

    // タグ生成の指示文（参考実装：固定タグの必須含有を要求）
    const tagsInstruction =
      '記事内容から最も関連する日本語タグを3〜5個生成し、半角スペース区切りで出力してください。必ず「#引き寄せ #引き寄せの法則 #裏技 #PR」を含めてください。本文や説明は禁止。';

    // タイトル装飾用絵文字（参考実装のセット）
    const titleEmojis = [
      '❤️',
      '🌸',
      '🛑',
      '㊙︎',
      '🟥',
      '🈲',
      '🉐',
      '㊗️',
      '㊙️',
      '⭕',
      '‼️',
      '🎉',
    ];

    // ----------------------------------------------------------------------------------

    // 有料記事設定（AI稼ぎ方.mdの価格帯に寄せる）
    const paidEnabled = true; // 有料記事にするか
    // 価格をランダムに選択（AI稼ぎ方.mdを参考にした価格帯）
    // const priceOptions = [1980, 2980, 3980];
    const priceOptions = [3980];
    const price = priceOptions[Math.floor(Math.random() * priceOptions.length)];
    console.log(`選択された価格: ${price}円`);

    // 記事内容配列（A）が存在するかチェック
    const articleContentsArray = Array.isArray(articleContents) && articleContents.length > 0
      ? articleContents
      : undefined;

    // 記事の自動生成と有料記事としての投稿機能を実行
    await core.runCreateAndPublishPaidArticle({
      background: wantsBackground,
      // 記事内容配列（A）が存在する場合はそれを渡す（存在しない場合は topics と patterns を使用）
      articleContents: articleContentsArray,
      topics,
      patterns,
      paidEnabled,
      price,
      systemMessage,
      articleConditionsLines,
      rewriteConditionsLines,
      tagsInstruction,
      titleEmojis,
      // 有料記事ではアフィリエイトリンク、おすすめ記事セクションは不要（core側で無効化）
      affiliateLinks: [],
      magazinePromotion: [],
      amazonAssociateText: '',
      // おすすめ記事セクション設定（有料記事では不要）
      recommendedArticlesTitle: '',
      recommendedArticlesUrls: [],
      // 有料記事用の設定
      maxTokens: 12000, // 長い記事を生成するため
      paidMode: true, // 有料記事モードを有効化
      paidRewriteHeading: '有料部分の内容について', // このセクションのみリライト
    });
    console.log('有料記事の自動生成と投稿が完了しました');
  });
})();
